## **1 .set** - è®¾ç½®å­—ç¬¦ä¸²é”®å€¼å¯¹

```python
await redis_client.set(key, value, expire=None)
```

**å«ä¹‰**ï¼šè®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„é”®å€¼å¯¹

**å‚æ•°**ï¼š

- `key`: é”®åï¼ˆå­—ç¬¦ä¸²ï¼‰
- `value`: å€¼ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—æˆ–ç®€å•å¯¹è±¡ï¼‰
- `expire`: è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå¯é€‰

**ç¤ºä¾‹**ï¼š

```python
# è®¾ç½®ç®€å•çš„é”®å€¼å¯¹
await redis.set("username", "å¼ ä¸‰")

# è®¾ç½®å¸¦è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼ˆ30ç§’åè‡ªåŠ¨åˆ é™¤ï¼‰
await redis.set("session_token", "abc123xyz", expire=30)

# è®¾ç½®æ•°å­—
await redis.set("user_count", 100)

# è®¾ç½®Pythonå¯¹è±¡ï¼ˆä¼šè‡ªåŠ¨åºåˆ—åŒ–ï¼‰
await redis.set("user:1001", {"name": "å¼ ä¸‰", "age": 25})
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š

- ç¼“å­˜ç”¨æˆ·ä¼šè¯ä¿¡æ¯
- å­˜å‚¨é…ç½®ä¿¡æ¯
- ç¼“å­˜APIå“åº”
- è®¡æ•°å™¨

## 2 **.hset** - è®¾ç½®å“ˆå¸Œå­—æ®µ

```python
await redis_client.hset(key, field, value)
# æˆ–æ‰¹é‡è®¾ç½®
await redis_client.hmset(key, {"field1": "value1", "field2": "value2"})
```

**å«ä¹‰**ï¼šåœ¨å“ˆå¸Œç»“æ„ä¸­è®¾ç½®ä¸€ä¸ªå­—æ®µçš„å€¼

**å‚æ•°**ï¼š

- `key`: å“ˆå¸Œçš„é”®å
- `field`: å­—æ®µå
- `value`: å­—æ®µå€¼

**ç¤ºä¾‹**ï¼š

```python
# è®¾ç½®å•ä¸ªå­—æ®µ
await redis.hset("user:1001", "name", "å¼ ä¸‰")

# æ‰¹é‡è®¾ç½®å¤šä¸ªå­—æ®µ
await redis.hmset("user:1001", {
    "name": "å¼ ä¸‰",
    "age": 25,
    "email": "zhangsan@example.com",
    "city": "åŒ—äº¬"
})
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š

- **ç”¨æˆ·ä¿¡æ¯å­˜å‚¨**ï¼šå°†ç”¨æˆ·çš„æ‰€æœ‰å±æ€§å­˜å‚¨åœ¨å“ˆå¸Œä¸­

```python
user_data = {
    "id": 1001,
    "username": "zhangsan",
    "email": "zhangsan@example.com",
    "created_at": "2024-01-15",
    "last_login": "2024-01-20",
    "status": "active"
}
await redis.hmset("user:1001", user_data)
```

- **ä¼šè¯ç®¡ç†**ï¼š

```python
session = {
    "session_id": "abc123",
    "user_id": 1001,
    "created_at": "2024-01-15 10:00:00",
    "last_activity": "2024-01-15 10:30:00",
    "ip_address": "192.168.1.100"
}
await redis.hmset("session:abc123", session)
```

## 3  **.lpush / .rpush** - åˆ—è¡¨æ¨å…¥æ“ä½œ

```python
await redis_client.lpush(key, *values)    # ä»å·¦ä¾§æ¨å…¥
await redis_client.rpush(key, *values)    # ä»å³ä¾§æ¨å…¥
```

**å«ä¹‰**ï¼šå‘åˆ—è¡¨çš„å·¦ä¾§æˆ–å³ä¾§æ¨å…¥å…ƒç´ 

**å‚æ•°**ï¼š

- `key`: åˆ—è¡¨çš„é”®å
- `*values`: è¦æ¨å…¥çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼

**ç¤ºä¾‹**ï¼š

```python
# ä»å·¦ä¾§æ¨å…¥ï¼ˆæ–°å…ƒç´ åœ¨å¼€å¤´ï¼‰
await redis.lpush("tasks", "task3", "task2", "task1")
# åˆ—è¡¨é¡ºåºï¼š["task1", "task2", "task3"]

# ä»å³ä¾§æ¨å…¥ï¼ˆæ–°å…ƒç´ åœ¨æœ«å°¾ï¼‰
await redis.rpush("messages", "msg1", "msg2", "msg3")
# åˆ—è¡¨é¡ºåºï¼š["msg1", "msg2", "msg3"]
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š

- **ä»»åŠ¡é˜Ÿåˆ—**ï¼ˆä½¿ç”¨lpush/rpushé…åˆlpop/rpopï¼‰ï¼š

  ```python
  # ç”Ÿäº§è€…ï¼šæ·»åŠ ä»»åŠ¡åˆ°é˜Ÿåˆ—
  await redis.lpush("task_queue", json.dumps({"task_id": 1, "type": "email"}))
  await redis.lpush("task_queue", json.dumps({"task_id": 2, "type": "sms"}))
  
  # æ¶ˆè´¹è€…ï¼šå¤„ç†ä»»åŠ¡
  task = await redis.rpop("task_queue")
  if task:
      task_data = json.loads(task)
      process_task(task_data)
  ```

## 4 **.lrange** - è·å–åˆ—è¡¨èŒƒå›´

```python
await redis_client.lrange(key, start, end)
```

**å«ä¹‰**ï¼šè·å–åˆ—è¡¨ä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ 

**å‚æ•°**ï¼š

- `key`: åˆ—è¡¨çš„é”®å
- `start`: èµ·å§‹ç´¢å¼•ï¼ˆ0è¡¨ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰
- `end`: ç»“æŸç´¢å¼•ï¼ˆ-1è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼‰

**ç¤ºä¾‹**ï¼š

```python
# è·å–æ‰€æœ‰å…ƒç´ 
all_items = await redis.lrange("mylist", 0, -1)

# è·å–å‰5ä¸ªå…ƒç´ 
first_five = await redis.lrange("mylist", 0, 4)

# è·å–æœ€å3ä¸ªå…ƒç´ 
last_three = await redis.lrange("mylist", -3, -1)
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š

- **åˆ†é¡µæŸ¥è¯¢**ï¼š

  ```python
  # è·å–æ¶ˆæ¯åˆ—è¡¨çš„ç¬¬1é¡µï¼ˆæ¯é¡µ10æ¡ï¼‰
  page = 1
  page_size = 10
  start = (page - 1) * page_size
  end = start + page_size - 1
  messages = await redis.lrange("messages", start, end)
  
  # æ€»æ¶ˆæ¯æ•°
  total = await redis.llen("messages")
  ```

## 5 **.sadd** - æ·»åŠ é›†åˆæˆå‘˜

```python
await redis_client.sadd(key, *members)
```

**å«ä¹‰**ï¼šå‘é›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼ˆé›†åˆä¼šè‡ªåŠ¨å»é‡ï¼‰

**å‚æ•°**ï¼š

- `key`: é›†åˆçš„é”®å
- `*members`: è¦æ·»åŠ çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜

**ç¤ºä¾‹**ï¼š

```python
# æ·»åŠ æ ‡ç­¾
await redis.sadd("article:1001:tags", "Python", "ç¼–ç¨‹", "Redis")

# æ·»åŠ ç”¨æˆ·åˆ°ç¾¤ç»„
await redis.sadd("group:developers:members", "user:1001", "user:1002", "user:1003")

# æ·»åŠ æ”¶è—
await redis.sadd("user:1001:favorites", "product:P001", "product:P002")
```

## 6 .sismember

```python
await redis.sismember(tags_key, "Python")
```

## 6 .scan_all("cache:*") 

- è·å–æ‰€æœ‰ç¼“å­˜é”® cache:å¼€å¤´

## 6 .ttl(key)

- è·å–è¿‡æœŸæ—¶é—´

```python
ttl = await redis_client.ttl(key)
if ttl <= 0:  # å·²è¿‡æœŸ
    expired_keys.append(key)
    print(f"  ğŸ”´ {key} å·²è¿‡æœŸï¼Œåˆ é™¤ä¸­...")
    await redis_client.delete(key)
```



## 6 **.smembers** - è·å–é›†åˆ(set)æ‰€æœ‰æˆå‘˜

```python
await redis_client.smembers(key)
```

**å«ä¹‰**ï¼šè·å–é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜

**å‚æ•°**ï¼š

- `key`: é›†åˆçš„é”®å

**ç¤ºä¾‹**ï¼š

```python
# è·å–æ‰€æœ‰æ ‡ç­¾
tags = await redis.smembers("article:1001:tags")

# è·å–ç¾¤ç»„æ‰€æœ‰æˆå‘˜
members = await redis.smembers("group:developers:members")

# è·å–ç”¨æˆ·æ‰€æœ‰æ”¶è—
favorites = await redis.smembers("user:1001:favorites")
```

## 7 **.delete** - åˆ é™¤é”®

```python
await redis_client.delete(*keys)
```

**å«ä¹‰**ï¼šåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé”®

**å‚æ•°**ï¼š

- `*keys`: è¦åˆ é™¤çš„ä¸€ä¸ªæˆ–å¤šä¸ªé”®å

**ç¤ºä¾‹**ï¼š

```python
# åˆ é™¤å•ä¸ªé”®
await redis.delete("user:1001:name")

# åˆ é™¤å¤šä¸ªé”®
await redis.delete("user:1001:name", "user:1001:age", "user:1001:email")

# åˆ é™¤æ•´ä¸ªç”¨æˆ·æ•°æ®
user_keys = ["user:1001:name", "user:1001:age", "user:1001:profile"]
await redis.delete(*user_keys)
```

## 8 .scard- è·å–é›†åˆæˆå‘˜æ•°é‡

![](D:\code_work_space\llm\huice\Issue-seven\Mindsweeper\tests\test_redis\111.png)

```python
key="user:user_1001:tags"
count = await redis.scard(key)
# 5
"""
è¿”å›ç»“æœ:
è¿”å›é›†åˆä¸­çš„æˆå‘˜æ•°é‡ï¼ˆæ•´æ•°ï¼‰
å¦‚æœé”®ä¸å­˜åœ¨æˆ–ä¸æ˜¯é›†åˆç±»å‹ï¼Œè¿”å› 0
"""
```

## 9 .exists - æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨

```python
await redis.exists(key)  # æ£€æŸ¥å•ä¸ªé”®
await redis.exists(key1, key2, key3)  # æ£€æŸ¥å¤šä¸ªé”®
"""
è¿”å›ç»“æœ:
å•ä¸ªé”®ï¼šè¿”å› 1ï¼ˆå­˜åœ¨ï¼‰æˆ– 0ï¼ˆä¸å­˜åœ¨ï¼‰
å¤šä¸ªé”®ï¼šè¿”å›å­˜åœ¨çš„é”®çš„æ•°é‡
"""
```



## æ•°æ®ç»“æ„å¯¹æ¯”æ€»ç»“

| å‘½ä»¤              | æ•°æ®ç»“æ„ | ç‰¹ç‚¹                       | é€‚ç”¨åœºæ™¯                 |
| :---------------- | :------- | :------------------------- | :----------------------- |
| **.set**          | å­—ç¬¦ä¸²   | ç®€å•çš„é”®å€¼å¯¹               | ç¼“å­˜ã€é…ç½®ã€è®¡æ•°å™¨       |
| **.hset**         | å“ˆå¸Œ     | å­—æ®µ-å€¼æ˜ å°„ï¼Œé€‚åˆå­˜å‚¨å¯¹è±¡  | ç”¨æˆ·ä¿¡æ¯ã€ä¼šè¯ã€å•†å“è¯¦æƒ… |
| **.lpush/.rpush** | åˆ—è¡¨     | æœ‰åºã€å¯é‡å¤ã€æ”¯æŒä¸¤ç«¯æ“ä½œ | é˜Ÿåˆ—ã€æ—¶é—´çº¿ã€å†å²è®°å½•   |
| **.sadd**         | é›†åˆ     | æ— åºã€ä¸é‡å¤ã€æ”¯æŒé›†åˆè¿ç®— | æ ‡ç­¾ã€å¥½å‹å…³ç³»ã€æŠ•ç¥¨ç³»ç»Ÿ |
| **.zadd**         | æœ‰åºé›†åˆ | æœ‰åºã€ä¸é‡å¤ã€å¸¦åˆ†æ•°       | æ’è¡Œæ¦œã€ä¼˜å…ˆçº§é˜Ÿåˆ—       |

## æ‰¹é‡æ“ä½œæé«˜æ€§èƒ½

```python
# ä½¿ç”¨ç®¡é“æ‰¹é‡æ“ä½œ
async with redis.pipeline() as pipe:
    pipe.set("key1", "value1")
    pipe.set("key2", "value2")
    pipe.hset("user:1001", "name", "å¼ ä¸‰")
    results = await pipe.execute()
```

## çŸ¥è¯†ç‚¹

- è¿‡æœŸçš„é”®ï¼Œé€šè¿‡.smembers .scard æˆ–è€… .existsè¿˜èƒ½æŸ¥åˆ°ä¹ˆï¼Ÿ

  | å‘½ä»¤             | è¿‡æœŸé”®çš„è¡Œä¸º   | è¿”å›ç»“æœ               |
  | :--------------- | :------------- | :--------------------- |
  | **`.exists`**    | âŒ **ä¸èƒ½**æŸ¥åˆ° | è¿”å› `0`ï¼ˆä¸å­˜åœ¨ï¼‰     |
  | **`.scard`**     | âŒ **ä¸èƒ½**æŸ¥åˆ° | è¿”å› `0`ï¼ˆé›†åˆä¸å­˜åœ¨ï¼‰ |
  | **`.smembers`**  | âŒ **ä¸èƒ½**æŸ¥åˆ° | è¿”å›ç©ºé›†åˆ `set()`     |
  | **æ‰€æœ‰è¯»å–å‘½ä»¤** | âŒ **ä¸èƒ½**æŸ¥åˆ° | è§†å‘½ä»¤è¿”å›ç›¸åº”ç©ºå€¼     |
  | **æ‰€æœ‰å†™å…¥å‘½ä»¤** | âœ… **å¯ä»¥**è¦†ç›– | åˆ é™¤æ—§é”®ï¼Œåˆ›å»ºæ–°é”®     |

