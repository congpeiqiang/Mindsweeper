# PDFæ–‡ä»¶ä¸Šä¼ æ¥å£å®Œæ•´æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æ˜¯MindsweeperçŸ¥è¯†åº“ç®¡ç†ç³»ç»ŸPDFæ–‡ä»¶ä¸Šä¼ æ¥å£çš„å®Œæ•´å‚è€ƒæŒ‡å—ï¼ŒåŒ…å«å¿«é€Ÿå¼€å§‹ã€è¯¦ç»†è®¾è®¡ã€å®ç°æŒ‡å—å’ŒAPIå‚è€ƒã€‚

**æ–‡æ¡£ç»“æ„**:
- å¿«é€Ÿå¼€å§‹ - 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
- æ¶æ„è®¾è®¡ - ç³»ç»Ÿæ¶æ„å’Œæ•°æ®æµ
- APIå‚è€ƒ - å®Œæ•´çš„APIç«¯ç‚¹è¯´æ˜
- å®ç°ç»†èŠ‚ - ä»£ç å®ç°é€»è¾‘
- é…ç½®è¯´æ˜ - ç¯å¢ƒå˜é‡å’Œé…ç½®
- æµ‹è¯•å’Œç›‘æ§ - æµ‹è¯•ç”¨ä¾‹å’Œç›‘æ§æŒ‡æ ‡

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ä¸Šä¼ PDFæ–‡ä»¶

```bash
# åŸºç¡€ä¸Šä¼ 
curl -X POST "http://localhost:8000/api/v1/files/upload" \
  -F "file=@document.pdf" \
  -F "kb_id=550e8400-e29b-41d4-a716-446655440000"

# å¸¦æè¿°çš„ä¸Šä¼ 
curl -X POST "http://localhost:8000/api/v1/files/upload" \
  -F "file=@document.pdf" \
  -F "kb_id=550e8400-e29b-41d4-a716-446655440000" \
  -F "description=è¿™æ˜¯ä¸€ä»½é‡è¦æ–‡æ¡£"
```

### 2. è·å–æ–‡ä»¶ä¿¡æ¯

```bash
curl -X GET "http://localhost:8000/api/v1/files/550e8400-e29b-41d4-a716-446655440000"
```

### 3. è·å–æ–‡ä»¶åˆ—è¡¨

```bash
curl -X GET "http://localhost:8000/api/v1/files?kb_id=550e8400-e29b-41d4-a716-446655440000&skip=0&limit=10"
```

### 4. åˆ é™¤æ–‡ä»¶

```bash
curl -X DELETE "http://localhost:8000/api/v1/files/550e8400-e29b-41d4-a716-446655440000"
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         APIå±‚ (FastAPI)             â”‚
â”‚  app/api/v1/files.py                â”‚
â”‚  - 4ä¸ªè·¯ç”±ç«¯ç‚¹                      â”‚
â”‚  - è¯·æ±‚éªŒè¯                         â”‚
â”‚  - å“åº”æ ¼å¼åŒ–                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æœåŠ¡å±‚ (Service)            â”‚
â”‚  app/services/file_service.py       â”‚
â”‚  - 8ä¸ªä¸šåŠ¡æ–¹æ³•                      â”‚
â”‚  - æ–‡ä»¶éªŒè¯                         â”‚
â”‚  - æ•°æ®åº“æ“ä½œ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®å±‚ (Schema)             â”‚
â”‚  app/schema/file.py                 â”‚
â”‚  - File ORMæ¨¡å‹                     â”‚
â”‚  - 11ä¸ªå­—æ®µ + 3ä¸ªç´¢å¼•               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®åº“ (PostgreSQL)         â”‚
â”‚  filesè¡¨                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·ä¸Šä¼ PDF
    â†“
APIæ¥æ”¶è¯·æ±‚ (éªŒè¯Content-Typeã€å‚æ•°)
    â†“
æ–‡ä»¶éªŒè¯ (æ‰©å±•åã€å¤§å°ã€çŸ¥è¯†åº“)
    â†“
æ–‡ä»¶ä¿å­˜ (ç”Ÿæˆå”¯ä¸€åç§°ã€ä¿å­˜åˆ°temp/)
    â†“
åˆ›å»ºæ•°æ®åº“è®°å½• (Fileè¡¨)
    â†“
è¿”å›æ–‡ä»¶IDå’ŒçŠ¶æ€
    â†“
åç»­å¤„ç† (å¼‚æ­¥ä»»åŠ¡)
```

### æ–‡ä»¶çŠ¶æ€è½¬æ¢

```
PROCESSING (åˆå§‹çŠ¶æ€)
    â†“
COMPLETED (å¤„ç†æˆåŠŸ) æˆ– FAILED (å¤„ç†å¤±è´¥)
```

---

## ğŸ“Š äº¤ä»˜æˆæœ

### ä»£ç å®ç° (876è¡Œ)

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| `app/api/v1/files.py` | 243 | 4ä¸ªAPIç«¯ç‚¹ |
| `app/services/file_service.py` | 244 | 8ä¸ªæœåŠ¡æ–¹æ³• |
| `app/models/schemas.py` | 337 | 4ä¸ªPydanticæ¨¡å‹ |
| `app/schema/file.py` | 52 | Fileæ•°æ®åº“æ¨¡å‹ |

### æ ¸å¿ƒåŠŸèƒ½

**APIç«¯ç‚¹** (4ä¸ª):
- `POST /api/v1/files/upload` - ä¸Šä¼ PDFæ–‡ä»¶
- `GET /api/v1/files/{file_id}` - è·å–æ–‡ä»¶ä¿¡æ¯
- `GET /api/v1/files` - è·å–æ–‡ä»¶åˆ—è¡¨
- `DELETE /api/v1/files/{file_id}` - åˆ é™¤æ–‡ä»¶

**æœåŠ¡æ–¹æ³•** (8ä¸ª):
- `validate_file()` - éªŒè¯æ–‡ä»¶
- `create_file_record()` - åˆ›å»ºè®°å½•
- `update_file_status()` - æ›´æ–°çŠ¶æ€
- `get_file()` - è·å–æ–‡ä»¶
- `get_files_by_kb()` - è·å–åˆ—è¡¨
- `delete_file()` - åˆ é™¤æ–‡ä»¶
- `save_upload_file()` - ä¿å­˜æ–‡ä»¶
- `move_to_processed()` - ç§»åŠ¨æ–‡ä»¶

---

## ğŸ“¡ APIå‚è€ƒ

### 1. ä¸Šä¼ æ–‡ä»¶æ¥å£

**è¯·æ±‚**:
```
POST /api/v1/files/upload
Content-Type: multipart/form-data

å‚æ•°:
- file: UploadFile (å¿…éœ€) - PDFæ–‡ä»¶
- kb_id: UUID (å¿…éœ€) - çŸ¥è¯†åº“ID
- description: string (å¯é€‰) - æ–‡ä»¶æè¿°
```

**å“åº”** (æˆåŠŸ):
```json
{
  "code": 200,
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ",
  "data": {
    "file_id": "550e8400-e29b-41d4-a716-446655440000",
    "filename": "document.pdf",
    "file_size": 1024000,
    "file_type": "pdf",
    "status": "processing",
    "created_at": "2024-01-01T12:00:00Z"
  }
}
```

### 2. è·å–æ–‡ä»¶ä¿¡æ¯æ¥å£

**è¯·æ±‚**:
```
GET /api/v1/files/{file_id}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "kb_id": "550e8400-e29b-41d4-a716-446655440001",
    "filename": "document.pdf",
    "file_type": "pdf",
    "file_size": 1024000,
    "status": "completed",
    "chunks_count": 50,
    "error_message": null,
    "created_at": "2024-01-01T12:00:00Z",
    "updated_at": "2024-01-01T12:05:00Z"
  }
}
```

### 3. è·å–æ–‡ä»¶åˆ—è¡¨æ¥å£

**è¯·æ±‚**:
```
GET /api/v1/files?kb_id={kb_id}&skip={skip}&limit={limit}

å‚æ•°:
- kb_id: UUID (å¿…éœ€) - çŸ¥è¯†åº“ID
- skip: integer (å¯é€‰) - è·³è¿‡æ•°é‡ï¼Œé»˜è®¤0
- limit: integer (å¯é€‰) - é™åˆ¶æ•°é‡ï¼Œé»˜è®¤10ï¼Œæœ€å¤§100
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 25,
    "skip": 0,
    "limit": 10,
    "items": [...]
  }
}
```

### 4. åˆ é™¤æ–‡ä»¶æ¥å£

**è¯·æ±‚**:
```
DELETE /api/v1/files/{file_id}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "æ–‡ä»¶åˆ é™¤æˆåŠŸ"
}
```

---

## ğŸ” å®ç°ç»†èŠ‚

### è¯·æ±‚å¤„ç†æµç¨‹

```
1. æ¥æ”¶HTTPè¯·æ±‚
   â”œâ”€ éªŒè¯Content-Type: multipart/form-data
   â”œâ”€ éªŒè¯å¿…éœ€å‚æ•°: file, kb_id
   â””â”€ éªŒè¯å¯é€‰å‚æ•°: description

2. æ–‡ä»¶éªŒè¯
   â”œâ”€ æ£€æŸ¥æ–‡ä»¶æ‰©å±•å (.pdfç­‰)
   â”œâ”€ æ£€æŸ¥æ–‡ä»¶å¤§å° (â‰¤100MB)
   â”œâ”€ æ£€æŸ¥çŸ¥è¯†åº“æ˜¯å¦å­˜åœ¨
   â””â”€ è¿”å›éªŒè¯ç»“æœ

3. æ–‡ä»¶ä¿å­˜
   â”œâ”€ è¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜
   â”œâ”€ ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å (æ—¶é—´æˆ³+åŸå§‹å)
   â”œâ”€ ä¿å­˜åˆ° uploads/temp/
   â””â”€ è¿”å›æ–‡ä»¶è·¯å¾„

4. æ•°æ®åº“æ“ä½œ
   â”œâ”€ åˆ›å»ºFileè®°å½•
   â”œâ”€ è®¾ç½®åˆå§‹çŠ¶æ€ä¸ºprocessing
   â”œâ”€ æäº¤äº‹åŠ¡
   â””â”€ è¿”å›æ–‡ä»¶ID

5. å“åº”è¿”å›
   â”œâ”€ æ ¼å¼åŒ–å“åº”æ•°æ®
   â”œâ”€ è¿”å›HTTP 200
   â””â”€ åŒ…å«æ–‡ä»¶IDå’ŒçŠ¶æ€
```

### æ–‡ä»¶éªŒè¯é€»è¾‘

**æ‰©å±•åéªŒè¯**:
```python
ALLOWED_EXTENSIONS = {'pdf', 'csv', 'txt', 'jpg', 'png', 'jpeg'}
file_ext = Path(filename).suffix.lower().lstrip('.')
if file_ext not in ALLOWED_EXTENSIONS:
    raise ValueError(f"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: {file_ext}")
```

**æ–‡ä»¶å¤§å°éªŒè¯**:
```python
MAX_FILE_SIZE = 100 * 1024 * 1024  # 100MB
if file_size > MAX_FILE_SIZE:
    raise ValueError(f"æ–‡ä»¶è¿‡å¤§")
```

**çŸ¥è¯†åº“éªŒè¯**:
```python
kb = db.query(KnowledgeBase).filter(KnowledgeBase.id == kb_id).first()
if not kb:
    raise HTTPException(status_code=404, detail="çŸ¥è¯†åº“ä¸å­˜åœ¨")
```

### æ–‡ä»¶ä¿å­˜ç­–ç•¥

**å”¯ä¸€æ–‡ä»¶åç”Ÿæˆ**:
```python
timestamp = datetime.utcnow().strftime("%Y%m%d_%H%M%S")
unique_filename = f"{timestamp}_{filename}"
```

**ç›®å½•ç»“æ„**:
```
uploads/
â”œâ”€â”€ temp/          # æ–°ä¸Šä¼ çš„æ–‡ä»¶ï¼Œç­‰å¾…å¤„ç†
â””â”€â”€ processed/     # å·²å¤„ç†çš„æ–‡ä»¶ï¼Œä¾¿äºæŸ¥è¯¢å’Œæ¢å¤
```

### æ•°æ®åº“æ¨¡å‹

**Fileè¡¨** (11ä¸ªå­—æ®µ):
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | æ–‡ä»¶IDï¼ˆä¸»é”®ï¼‰ |
| kb_id | UUID | çŸ¥è¯†åº“IDï¼ˆå¤–é”®ï¼‰ |
| filename | String(255) | æ–‡ä»¶å |
| file_type | String(50) | æ–‡ä»¶ç±»å‹ |
| file_size | BigInteger | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| file_path | String(500) | æ–‡ä»¶è·¯å¾„ |
| status | String(50) | å¤„ç†çŠ¶æ€ |
| error_message | Text | é”™è¯¯ä¿¡æ¯ |
| chunks_count | Integer | åˆ†å—æ•°é‡ |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |
| updated_at | DateTime | æ›´æ–°æ—¶é—´ |
| deleted_at | DateTime | åˆ é™¤æ—¶é—´ï¼ˆè½¯åˆ é™¤ï¼‰ |

**ç´¢å¼•è®¾è®¡** (3ä¸ª):
```python
Index("idx_files_kb_id", "kb_id")           # çŸ¥è¯†åº“æŸ¥è¯¢
Index("idx_files_status", "status")         # çŠ¶æ€æŸ¥è¯¢
Index("idx_files_created_at", "created_at") # æ—¶é—´æ’åº
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

```bash
# ä¸Šä¼ ç›®å½•
UPLOAD_DIR=./uploads

# æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
MAX_FILE_SIZE=104857600  # 100MB

# å…è®¸çš„æ–‡ä»¶æ‰©å±•å
ALLOWED_EXTENSIONS=pdf,csv,txt,jpg,png,jpeg
```

### æ•°æ®æ¨¡å‹

**FileUploadRequest**:
```python
class FileUploadRequest(BaseModel):
    kb_id: UUID = Field(..., description="çŸ¥è¯†åº“ID")
    description: Optional[str] = Field(None, description="æ–‡ä»¶æè¿°")
```

**FileUploadResponse**:
```python
class FileUploadResponse(BaseModel):
    file_id: UUID
    filename: str
    file_size: int
    file_type: str
    status: FileStatus
    created_at: datetime
```

**FileResponse**:
```python
class FileResponse(BaseModel):
    id: UUID
    kb_id: UUID
    filename: str
    file_type: Optional[str]
    file_size: int
    status: FileStatus
    chunks_count: int
    error_message: Optional[str]
    created_at: datetime
    updated_at: datetime
```

---

## âš ï¸ é”™è¯¯å¤„ç†

### é”™è¯¯ç å‚è€ƒ

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|--------|
| 400 | ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ | æ£€æŸ¥æ–‡ä»¶æ‰©å±•åï¼Œæ”¯æŒ: pdf, csv, txt, jpg, png, jpeg |
| 400 | æ–‡ä»¶è¿‡å¤§ | å‡å°æ–‡ä»¶å¤§å°ï¼Œæœ€å¤§100MB |
| 404 | çŸ¥è¯†åº“ä¸å­˜åœ¨ | æ£€æŸ¥kb_idæ˜¯å¦æ­£ç¡® |
| 404 | æ–‡ä»¶ä¸å­˜åœ¨ | æ£€æŸ¥file_idæ˜¯å¦æ­£ç¡® |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿— |

### é”™è¯¯å¤„ç†ç¤ºä¾‹

```python
# æ–‡ä»¶æ ¼å¼é”™è¯¯
HTTPException(status_code=400, detail="ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼")

# æ–‡ä»¶å¤§å°é”™è¯¯
HTTPException(status_code=400, detail="æ–‡ä»¶è¿‡å¤§")

# çŸ¥è¯†åº“ä¸å­˜åœ¨
HTTPException(status_code=404, detail="çŸ¥è¯†åº“ä¸å­˜åœ¨")

# æ–‡ä»¶ä¿å­˜å¤±è´¥
HTTPException(status_code=500, detail="æ–‡ä»¶ä¿å­˜å¤±è´¥")
```

---

## ğŸ” å®‰å…¨ç‰¹æ€§

### å·²å®ç°

âœ… æ–‡ä»¶æ ¼å¼éªŒè¯ - åªå…è®¸ç‰¹å®šæ‰©å±•å  
âœ… æ–‡ä»¶å¤§å°é™åˆ¶ - æœ€å¤§100MB  
âœ… çŸ¥è¯†åº“éªŒè¯ - ç¡®ä¿çŸ¥è¯†åº“å­˜åœ¨  
âœ… UUIDä¸»é”® - é˜²æ­¢IDçŒœæµ‹  
âœ… è½¯åˆ é™¤ - ä¿ç•™æ•°æ®å¯æ¢å¤  
âœ… å”¯ä¸€æ–‡ä»¶å - é¿å…è¦†ç›–  

### å¾…å®ç°

âš ï¸ ç—…æ¯’æ‰«æ - ä½¿ç”¨ClamAVæˆ–ç±»ä¼¼å·¥å…·  
âš ï¸ ç”¨æˆ·æƒé™ - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™  
âš ï¸ é€Ÿç‡é™åˆ¶ - é˜²æ­¢æ»¥ç”¨  
âš ï¸ æ–‡ä»¶åŠ å¯† - åŠ å¯†å­˜å‚¨æ•æ„Ÿæ–‡ä»¶  
âš ï¸ è®¿é—®æ—¥å¿— - è®°å½•æ‰€æœ‰æ“ä½œ  

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

- ä½¿ç”¨3ä¸ªç´¢å¼•åŠ é€ŸæŸ¥è¯¢
- è¿æ¥æ± ç®¡ç†
- äº‹åŠ¡å¤„ç†
- è‡ªåŠ¨æäº¤å’Œå›æ»š

### æ–‡ä»¶æ“ä½œä¼˜åŒ–

- ä¸€æ¬¡æ€§è¯»å–æ–‡ä»¶åˆ°å†…å­˜
- ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åé¿å…å†²çª
- åˆ†ç¦»tempå’Œprocessedç›®å½•

### ç¼“å­˜ç­–ç•¥

- ç¼“å­˜æ–‡ä»¶å…ƒæ•°æ®
- ç¼“å­˜çŸ¥è¯†åº“ä¿¡æ¯
- ç¼“å­˜ç”¨æˆ·æƒé™

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æ­£å¸¸ä¸Šä¼ 

```python
def test_upload_pdf_success():
    kb_id = create_test_kb()
    file_content = b"PDF content"
    
    response = client.post(
        "/api/v1/files/upload",
        files={"file": ("test.pdf", file_content)},
        data={"kb_id": kb_id}
    )
    
    assert response.status_code == 200
    assert response.json()["data"]["file_id"]
```

### æ–‡ä»¶æ ¼å¼é”™è¯¯

```python
def test_upload_invalid_format():
    response = client.post(
        "/api/v1/files/upload",
        files={"file": ("test.exe", b"content")},
        data={"kb_id": kb_id}
    )
    assert response.status_code == 400
```

### æ–‡ä»¶è¿‡å¤§

```python
def test_upload_oversized_file():
    large_content = b"x" * (101 * 1024 * 1024)
    response = client.post(
        "/api/v1/files/upload",
        files={"file": ("large.pdf", large_content)},
        data={"kb_id": kb_id}
    )
    assert response.status_code == 400
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### å…³é”®æŒ‡æ ‡

```python
# ä¸Šä¼ æˆåŠŸç‡
success_rate = successful_uploads / total_uploads

# å¹³å‡ä¸Šä¼ æ—¶é—´
avg_upload_time = sum(upload_times) / len(upload_times)

# æ–‡ä»¶å¤§å°åˆ†å¸ƒ
file_size_distribution = {
    "< 1MB": count,
    "1-10MB": count,
    "> 10MB": count
}
```

### æ—¥å¿—è®°å½•

```python
logger.info(f"æ–‡ä»¶ä¸Šä¼ å¼€å§‹: {filename}")
logger.info(f"æ–‡ä»¶éªŒè¯é€šè¿‡: {filename}")
logger.info(f"æ–‡ä»¶ä¿å­˜æˆåŠŸ: {file_path}")
logger.info(f"æ•°æ®åº“è®°å½•åˆ›å»º: {file_id}")
logger.error(f"æ–‡ä»¶ä¸Šä¼ å¤±è´¥: {error_message}")
```

---

## ğŸ’» Pythonå®¢æˆ·ç«¯ç¤ºä¾‹

```python
import requests

def upload_file(file_path: str, kb_id: str):
    url = "http://localhost:8000/api/v1/files/upload"
    with open(file_path, 'rb') as f:
        files = {'file': f}
        data = {'kb_id': kb_id}
        response = requests.post(url, files=files, data=data)
        return response.json()

def get_file(file_id: str):
    url = f"http://localhost:8000/api/v1/files/{file_id}"
    response = requests.get(url)
    return response.json()

def list_files(kb_id: str, skip: int = 0, limit: int = 10):
    url = "http://localhost:8000/api/v1/files"
    params = {'kb_id': kb_id, 'skip': skip, 'limit': limit}
    response = requests.get(url, params=params)
    return response.json()

def delete_file(file_id: str):
    url = f"http://localhost:8000/api/v1/files/{file_id}"
    response = requests.delete(url)
    return response.json()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    kb_id = "550e8400-e29b-41d4-a716-446655440000"
    
    result = upload_file("document.pdf", kb_id)
    file_id = result['data']['file_id']
    print(f"ä¸Šä¼ æˆåŠŸ: {file_id}")
    
    file_info = get_file(file_id)
    print(f"æ–‡ä»¶ä¿¡æ¯: {file_info}")
    
    files = list_files(kb_id)
    print(f"æ–‡ä»¶åˆ—è¡¨: {files}")
    
    delete_result = delete_file(file_id)
    print(f"åˆ é™¤ç»“æœ: {delete_result}")
```

---

## ğŸ§ª æµ‹è¯•å‘½ä»¤

### ä½¿ç”¨curl

```bash
# ä¸Šä¼ 
curl -X POST "http://localhost:8000/api/v1/files/upload" \
  -F "file=@document.pdf" \
  -F "kb_id=550e8400-e29b-41d4-a716-446655440000"

# è·å–ä¿¡æ¯
curl -X GET "http://localhost:8000/api/v1/files/550e8400-e29b-41d4-a716-446655440000"

# åˆ—è¡¨
curl -X GET "http://localhost:8000/api/v1/files?kb_id=550e8400-e29b-41d4-a716-446655440000"

# åˆ é™¤
curl -X DELETE "http://localhost:8000/api/v1/files/550e8400-e29b-41d4-a716-446655440000"
```

### ä½¿ç”¨httpie

```bash
# ä¸Šä¼ 
http -f POST localhost:8000/api/v1/files/upload \
  file@document.pdf \
  kb_id=550e8400-e29b-41d4-a716-446655440000

# è·å–ä¿¡æ¯
http GET localhost:8000/api/v1/files/550e8400-e29b-41d4-a716-446655440000

# åˆ—è¡¨
http GET localhost:8000/api/v1/files \
  kb_id==550e8400-e29b-41d4-a716-446655440000

# åˆ é™¤
http DELETE localhost:8000/api/v1/files/550e8400-e29b-41d4-a716-446655440000
```

---

## ğŸ”„ åç»­å¤„ç†æµç¨‹

### å¼‚æ­¥å¤„ç†

```
æ–‡ä»¶ä¸Šä¼ å®Œæˆ
    â†“
å‘é€å¼‚æ­¥ä»»åŠ¡åˆ°Celery
    â†“
åå°å¤„ç†æ–‡ä»¶
    â”œâ”€ æå–PDFæ–‡æœ¬
    â”œâ”€ æ–‡æœ¬åˆ†å—
    â”œâ”€ å‘é‡åŒ–
    â””â”€ å­˜å‚¨åˆ°Milvus
    â†“
æ›´æ–°æ–‡ä»¶çŠ¶æ€ä¸ºCOMPLETED
```

### çŠ¶æ€æ›´æ–°

```python
# å¤„ç†æˆåŠŸ
file_service.update_file_status(
    file_id=file_id,
    status=FileStatus.COMPLETED,
    chunks_count=50
)

# å¤„ç†å¤±è´¥
file_service.update_file_status(
    file_id=file_id,
    status=FileStatus.FAILED,
    error_message="PDFè§£æå¤±è´¥"
)
```

---

## ğŸ“š ç›¸å…³èµ„æº

- [FastAPIæ–‡ä»¶ä¸Šä¼ æ–‡æ¡£](https://fastapi.tiangolo.com/tutorial/request-files/)
- [SQLAlchemy ORMæ–‡æ¡£](https://docs.sqlalchemy.org/)
- [PostgreSQLæ–‡æ¡£](https://www.postgresql.org/docs/)
- [é¡¹ç›®æ¶æ„è®¾è®¡](../../docs/é¡¹ç›®æ¶æ„è®¾è®¡.md)
- [APIæ–‡æ¡£](../../docs/APIæ–‡æ¡£.md)
- [æ–‡ä»¶å¤„ç†æµç¨‹](../../docs/æ–‡ä»¶å¤„ç†æµç¨‹.md)
- [å¼€å‘æŒ‡å—](../../docs/å¼€å‘æŒ‡å—.md)

---

## âœ… å®Œæˆæ¸…å•

- âœ… APIå±‚å®ç° (4ä¸ªç«¯ç‚¹)
- âœ… æœåŠ¡å±‚å®ç° (8ä¸ªæ–¹æ³•)
- âœ… æ•°æ®æ¨¡å‹å®šä¹‰ (4ä¸ªPydanticæ¨¡å‹)
- âœ… æ•°æ®åº“æ¨¡å‹ (Fileè¡¨)
- âœ… æ–‡ä»¶éªŒè¯é€»è¾‘
- âœ… é”™è¯¯å¤„ç†
- âœ… å®‰å…¨ç‰¹æ€§
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… æµ‹è¯•ç”¨ä¾‹
- âœ… ç›‘æ§æ—¥å¿—
- âœ… å®¢æˆ·ç«¯ç¤ºä¾‹
- âœ… å®Œæ•´æ–‡æ¡£

---

## ğŸ¯ åç»­æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šæµ‹è¯•
1. ç¼–å†™å•å…ƒæµ‹è¯•
2. ç¼–å†™é›†æˆæµ‹è¯•
3. æ€§èƒ½æµ‹è¯•

### ç¬¬äºŒé˜¶æ®µï¼šæ‰©å±•
1. å®ç°PDFæ–‡æœ¬æå–
2. å®ç°æ–‡æœ¬åˆ†å—
3. å®ç°å‘é‡åŒ–å¤„ç†

### ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–
1. æ·»åŠ ç—…æ¯’æ‰«æ
2. æ·»åŠ ç”¨æˆ·æƒé™
3. æ·»åŠ é€Ÿç‡é™åˆ¶
4. æ·»åŠ æ–‡ä»¶åŠ å¯†

---

**é¡¹ç›®åç§°**: Mindsweeper  
**æ¨¡å—**: PDFæ–‡ä»¶ä¸Šä¼ æ¥å£  
**ç‰ˆæœ¬**: 1.0.0  
**çŠ¶æ€**: âœ… å®Œæˆ  
**æœ€åæ›´æ–°**: 2024å¹´1æœˆ  
**ç»´æŠ¤è€…**: Mindsweeper Team

